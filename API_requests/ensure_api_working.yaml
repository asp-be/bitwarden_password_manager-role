- name: Wait for API to be reachable
  uri:
    url: "http://localhost:8087/status"
    method: GET
    status_code: 200
  register: api_status
  until: api_status.data.status == unlocked
  retries: 20
  delay: 10
  delegate_to: localhost

- name: Set role facts
  set_facts:
    api_status: 200